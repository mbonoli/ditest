<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>8 Canvas drawing - example 3</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="//d3js.org/d3.v5.js"></script>
<style type="text/css">

	canvas { border:  1px solid #ccc; }

	button {
		display: inline-block;
		position:  absolute;
		width: 6em;
		margin: 0;
		padding: .5em;
		outline: none;
		color: #555;
		background-color: #f7f7f7;
		border: 1px dotted #f0f0f0;
		-webkit-transition: all 0.3s ease;
		transition: all 0.3s ease;
		cursor: pointer;
	}

	button:hover {
		background-color: rgba(173, 206, 255, .7);
	}

	button#drawScenario { top: 20px; left: 1050px; }
	button#update { top: 140px; left: 1050px; }
	button#exit { top: 260px; left: 1050px; }

</style>
</head>
<body>

<canvas id="main-canvas" width="1000" height="1000"></canvas>
<button id="drawScenario"><strong>Escenario</strong></button>
<button id="update"><strong>Update</strong><br>makes it rain</button>
<button id="exit"><strong>Exit</strong><br> makes grass</button>


<script>

/* Simulation Parameters */ 
/* ============================= */

var minXmin = 60;
var fps = 400;

/* Setting up canvas and context */ 
/* ============================= */ 

var canvas = d3.select('#main-canvas').node();
var context = canvas.getContext('2d');

var stations = [[605.654523970624, 391.859958398589], [773.383940941416, 330.237356150664], [829.552362038819, 208.675173877569], [829.242778181029, 270.722703648441], [822.028640941926, 97.5005483253709], [334.085982705588, 411.448177970356], [714.705126310918, 243.876698354134], [636.087101135137, 217.222590303992], [465.873408685324, 386.766978100552], [859.729672677234, 180.59098411591], [676.345785637978, 273.383408209902], [638.983004305235, 326.402322354239], [471.062095393883, 219.232781861848], [283.446183281607, 426.696856657456], [547.91221106626, 287.218672720825], [774.378572413437, 217.034375012894], [354.681515007027, 240.240049383635], [719.547120172919, 168.718885713666], [747.438689128053, 311.885704412382], [136.281982530575, 412.042655481998], [699.66532944579, 320.390062868301], [728.247710317741, 280.01135410759], [716.823529668492, 213.040267019898], [381.007782285443, 350.23190699236], [880.110584463742, 275.417523116266], [629.972276039237, 284.755061468775], [415.892880511532, 133.024875070426], [204.892212342234, 226.811793121144], [470.927879453782, 21.0701439555834], [558.787211939989, 344.54336653773], [785.660038177139, 231.577251451431], [801.581817186663, 305.873201281663], [756.504326579971, 246.950282794153], [744.441157415583, 230.361395854634], [696.574084841615, 301.553819881257], [461.617809080677, 43.9435692825286], [546.051016358433, 300.664715651016], [779.705816286299, 284.67981794037], [787.18535614938, 253.276988887457], [394.994306417109, 441.700024074003], [700.823090188019, 271.601958423556], [777.50302729209, 175.201117432171], [753.605545732856, 291.613225749482], [778.516512855761, 308.779400451847], [727.432188263576, 251.688959784316], [808.264177702752, 271.260924565443], [672.768974751815, 238.618468790133], [813.771202572644, 194.711803762849], [394.301000360586, 235.740175582629], [283.952557509546, 233.521220794028], [424.482629961847, 345.64560193319], [382.20020793073, 365.253421805246], [804.083964955722, 246.153193407286], [204.421007350584, 443.62675276083], [295.313920400429, 351.20649177555], [582.105873079882, 232.588361043448], [586.744983168819, 320.069437538342], [156.063760190262, 261.329985774318], [63.4682927805163, 335.253412037284], [697.07276282109, 262.415673642568], [208.069685189309, 252.144894398689], [785.412371147934, 211.670404194845], [811.319028716542, 222.725632851616], [741.496342632417, 268.306119591988], [492.403399634785, 308.903834455294], [775.945852822705, 192.979942536168], [793.346287013014, 285.39783186341], [195.010328506931, 306.17849866197], [423.630410252585, 263.097497985736], [264.916061790591, 276.605552654485], [557.182239802296, 167.947671980767], [810.896706410534, 178.662060492707], [741.989353172484, 205.599342489343], [795.13916551212, 316.132794486869], [576.927054212614, 267.014350873591], [447.898850328062, 317.02552610537], [401.995929139985, 316.940587602662], [288.235658591875, 329.691872442262], [822.855984000889, 286.256714954889], [621.502358284374, 361.36728978432], [522.926080106919, 388.313078392597], [493.602261335424, 198.084688445508], [720.90197500647, 337.882545729491], [245.391299943695, 124.687759481822], [291.46047673425, 31.030181996575], [233.822366399282, 152.717251345363], [273.156664948479, 52.2144282958913], [320.525495396481, 94.1374513678187], [517.478642864291, 142.762313718687], [597.421572807059, 352.649595647091], [876.633457128146, 205.555830995297], [884.991920525695, 164.099219803271], [506.953553903487, 172.372091397881], [572.87605601856, 182.90598621377], [486.095001243165, 75.1905624814857], [583.023013123205, 208.490845326656], [544.266075744447, 202.930082034921], [447.171318127933, 167.572312091914], [905.776623922283, 204.987307270301], [125.695469559675, 283.160407351763], [130.24844312515, 353.305186919376], [950, 94.3758697016759], [386.232522175763, 204.544374986299], [922.657459681519, 167.984612264436], [346.636257825867, 268.527554994491], [658.354863934358, 271.407372283805], [716.829467159105, 201.198414182101], [555.876903687046, 357.719168237206], [836.07757178288, 255.031388265185], [784.283846741756, 261.600384871131], [726.357037042473, 305.036594701847], [710.468847500084, 181.812727021129], [418.684952651334, 280.473528322828], [850.126265009386, 164.197423595169], [742.132836483551, 257.703842304328], [524.690590697629, 60.5082605425742], [327.354422266944, 293.524920196759], [184.015674893121, 329.468947407766], [386.769528424529, 270.465184166788], [339.69530361425, 336.521987502038], [252.328574427018, 303.485675448084], [539.852982052594, 365.895551874145], [478.75743375891, 270.340645633465], [294.055939857212, 375.330556192017], [201.295204492086, 280.86584206955], [260.031080262275, 183.765272009566], [333.637767809241, 376.928662179808], [416.698098557035, 405.229292053031], [408.735995008372, 64.8657681551097], [383.766545891197, 52.8807588241759], [905.51644596653, 59.8926404539586], [483.302261684501, 396.165712437772], [824.674645719453, 21.4483098085718], [10, 363.085721684036], [803.027510667104, 81.1371438285139], [715.44081589321, 228.292768842984], [774.043040130585, 138.175285075797], [173.879192383013, 409.218589941999], [420.502531336524, 329.534801520176], [104.790219662975, 328.605484135948], [894.573642333705, 81.9152909816742], [644.061173501935, 262.359176711834], [809.886673825486, 115.058087091626], [459.757228117451, 137.298674175773], [583.607259045565, 147.680927826923], [885.856246910788, 249.555138081466], [500.232367355566, 429.126878383319], [341.571240018067, 458.142015981545], [198.643415556467, 424.067566087271], [650.230131689132, 54.1781258702868], [778.489864668567, 334.459998919405], [779.204042669693, 335.075002918672], [572.429923713285, 83.5778883627566], [206.740533289537, 405.500978154604], [383.922003105936, 251.731349466797], [843.326649490636, 178.147329792894], [265.395797019928, 389.598369487657], [779.128127140174, 151.987988994098], [509.125464046449, 333.395270156199], [625.076946210129, 204.791539500421], [30.315274809162, 332.689896929597], [259.011828053513, 343.496716371452], [732.636022550141, 103.01328279612], [731.427553294949, 102.761269875097], [414.360220044232, 10], [470.895430403639, 220.969663154622], [267.916779331419, 97.4490627847906], [178.063118396756, 379.456118969627], [515.339955914444, 221.728168769206], [477.084821857444, 283.680911083642], [459.147291011028, 296.513625539772], [711.917570290897, 160.593516893862], [538.347001359934, 260.804776576364], [458.063716496991, 426.295338695682], [420.396994072848, 203.604962124595], [614.248238192811, 299.785818939753], [418.17287342654, 490], [297.272085978393, 129.068072302514], [339.090940367946, 152.885963906014], [631.913938497596, 180.029182127461], [326.612640067507, 77.5022304437795], [465.893781450174, 200.142779498435], [670.699469632988, 296.284049000299], [477.012228890079, 339.868953909196], [319.10187994294, 243.146884026434], [215.079225636181, 211.580094252262], [616.437748131846, 82.0058589685075], [670.976154999463, 357.048863341897], [231.393652974161, 166.805498035806], [653.206342948152, 105.660920262403], [427.031299857551, 379.186564870923], [310.455664678979, 193.332711255133], [382.753234032147, 135.705346834195], [494.477394255216, 57.8859521499268], [857.130644244946, 100.921750248129], [651.312244246521, 223.341148104599], [96.3411466366245, 370.30958332532], [492.355662592279, 358.894703437085], [910.595243214883, 27.0342619508488]];

var trips = [{"x":658.3549,"y":271.4074,"step0":0,"agentStep":1,"dx":-0.0928,"dy":-0.3206,"nsteps":285},{"x":670.9762,"y":357.0489,"step0":611,"agentStep":1,"dx":-0.7287,"dy":-0.222,"nsteps":390},{"x":885.8562,"y":249.5551,"step0":735,"agentStep":1,"dx":-0.7757,"dy":0.0611,"nsteps":720},{"x":522.9261,"y":388.3131,"step0":740,"agentStep":1,"dx":-0.9058,"dy":-0.3135,"nsteps":405},{"x":885.8562,"y":249.5551,"step0":755,"agentStep":1,"dx":-0.7599,"dy":0.0598,"nsteps":735},{"x":264.9161,"y":276.6056,"step0":777,"agentStep":1,"dx":0.2204,"dy":-0.0461,"nsteps":540},{"x":264.9161,"y":276.6056,"step0":812,"agentStep":1,"dx":0.2267,"dy":-0.0474,"nsteps":525},{"x":414.3602,"y":10,"step0":889,"agentStep":1,"dx":0.608,"dy":0.5428,"nsteps":465},{"x":714.7051,"y":243.8767,"step0":952,"agentStep":1,"dx":0.3175,"dy":-0.0751,"nsteps":510},{"x":714.7051,"y":243.8767,"step0":976,"agentStep":1,"dx":0.2773,"dy":-0.1263,"nsteps":255},{"x":415.8929,"y":133.0249,"step0":1141,"agentStep":1,"dx":1.687,"dy":0.1983,"nsteps":180},{"x":260.0311,"y":183.7653,"step0":1249,"agentStep":1,"dx":0.9718,"dy":-0.0498,"nsteps":465},{"x":424.4826,"y":345.6456,"step0":1410,"agentStep":1,"dx":-0.4507,"dy":-1.0435,"nsteps":90},{"x":334.086,"y":411.4482,"step0":1561,"agentStep":1,"dx":-0.5561,"dy":-0.5033,"nsteps":135},{"x":597.4216,"y":352.6496,"step0":1817,"agentStep":1,"dx":-1.6614,"dy":-0.3958,"nsteps":90},{"x":885.8562,"y":249.5551,"step0":1883,"agentStep":1,"dx":-0.2868,"dy":0.0788,"nsteps":660},{"x":785.4124,"y":211.6704,"step0":2342,"agentStep":1,"dx":0.5529,"dy":-0.0371,"nsteps":165},{"x":756.5043,"y":246.9503,"step0":2616,"agentStep":1,"dx":-1.2709,"dy":-0.0393,"nsteps":285},{"x":756.5043,"y":246.9503,"step0":2637,"agentStep":1,"dx":-1.2709,"dy":-0.0393,"nsteps":285},{"x":910.5952,"y":27.0343,"step0":2642,"agentStep":1,"dx":-0.3659,"dy":0.8085,"nsteps":375},{"x":267.9168,"y":97.4491,"step0":2805,"agentStep":1,"dx":1.421,"dy":0.2952,"nsteps":135},{"x":215.0792,"y":211.5801,"step0":3175,"agentStep":1,"dx":0.9451,"dy":0.0997,"nsteps":510},{"x":779.1281,"y":151.988,"step0":3438,"agentStep":1,"dx":-0.7076,"dy":0.2606,"nsteps":735},{"x":885.8562,"y":249.5551,"step0":3609,"agentStep":1,"dx":-0.8621,"dy":0.2412,"nsteps":90},{"x":614.2482,"y":299.7858,"step0":3729,"agentStep":1,"dx":-0.1681,"dy":0.1356,"nsteps":330},{"x":572.4299,"y":83.5779,"step0":3868,"agentStep":1,"dx":0.1087,"dy":-0.0039,"nsteps":405},{"x":885.8562,"y":249.5551,"step0":3942,"agentStep":1,"dx":-1.0088,"dy":-0.0337,"nsteps":675},{"x":273.1567,"y":52.2144,"step0":3985,"agentStep":1,"dx":0.1098,"dy":0.6473,"nsteps":555},{"x":459.7572,"y":137.2987,"step0":4147,"agentStep":1,"dx":0.3475,"dy":0.7272,"nsteps":285},{"x":670.9762,"y":357.0489,"step0":4251,"agentStep":1,"dx":-1.0518,"dy":0.1524,"nsteps":195},{"x":10,"y":363.0857,"step0":4364,"agentStep":1,"dx":0.9109,"dy":-0.3915,"nsteps":210},{"x":582.1059,"y":232.5884,"step0":4405,"agentStep":1,"dx":1.1679,"dy":-0.4388,"nsteps":315},{"x":885.8562,"y":249.5551,"step0":4558,"agentStep":1,"dx":-0.0255,"dy":0.1149,"nsteps":225},{"x":408.736,"y":64.8658,"step0":4571,"agentStep":1,"dx":0.7203,"dy":0.2031,"nsteps":690},{"x":885.8562,"y":249.5551,"step0":4573,"agentStep":1,"dx":-1.0816,"dy":0.3081,"nsteps":630},{"x":509.1255,"y":333.3953,"step0":4668,"agentStep":1,"dx":3.601,"dy":0.0224,"nsteps":75},{"x":156.0638,"y":261.33,"step0":4722,"agentStep":1,"dx":0.9071,"dy":0.1273,"nsteps":120},{"x":880.1106,"y":275.4175,"step0":5276,"agentStep":1,"dx":-1.5015,"dy":0.3738,"nsteps":450},{"x":809.8867,"y":115.0581,"step0":5283,"agentStep":1,"dx":-0.7289,"dy":-0.2021,"nsteps":465},{"x":327.3544,"y":293.5249,"step0":5870,"agentStep":1,"dx":0.1233,"dy":0.1304,"nsteps":435},{"x":876.6335,"y":205.5558,"step0":5882,"agentStep":1,"dx":-0.5098,"dy":-0.0532,"nsteps":480},{"x":880.1106,"y":275.4175,"step0":5918,"agentStep":1,"dx":-2.3708,"dy":0.5902,"nsteps":285},{"x":259.0118,"y":343.4967,"step0":5967,"agentStep":1,"dx":-0.0534,"dy":-0.8581,"nsteps":255},{"x":670.9762,"y":357.0489,"step0":5972,"agentStep":1,"dx":0.754,"dy":-0.3772,"nsteps":285},{"x":424.4826,"y":345.6456,"step0":6157,"agentStep":1,"dx":-0.4625,"dy":-0.2482,"nsteps":210},{"x":204.421,"y":443.6268,"step0":6232,"agentStep":1,"dx":0.2426,"dy":-0.445,"nsteps":225},{"x":459.7572,"y":137.2987,"step0":6315,"agentStep":1,"dx":0.8887,"dy":0.5591,"nsteps":300},{"x":260.0311,"y":183.7653,"step0":6323,"agentStep":1,"dx":0.3414,"dy":-0.5449,"nsteps":195},{"x":327.3544,"y":293.5249,"step0":6337,"agentStep":1,"dx":0.6708,"dy":0.1479,"nsteps":345},{"x":381.0078,"y":350.2319,"step0":6427,"agentStep":1,"dx":0.0177,"dy":-0.597,"nsteps":165},{"x":670.9762,"y":357.0489,"step0":6584,"agentStep":1,"dx":-1.22,"dy":0.3744,"nsteps":270},{"x":544.2661,"y":202.9301,"step0":6589,"agentStep":1,"dx":-0.4367,"dy":0.4494,"nsteps":150},{"x":629.9723,"y":284.7551,"step0":6759,"agentStep":1,"dx":0.468,"dy":-0.0226,"nsteps":210},{"x":586.745,"y":320.0694,"step0":6819,"agentStep":1,"dx":1.4697,"dy":-0.2991,"nsteps":165},{"x":670.9762,"y":357.0489,"step0":6924,"agentStep":1,"dx":-0.0408,"dy":-0.1435,"nsteps":660},{"x":876.6335,"y":205.5558,"step0":6953,"agentStep":1,"dx":0.0181,"dy":0.0863,"nsteps":510},{"x":294.0559,"y":375.3306,"step0":7078,"agentStep":1,"dx":-0.073,"dy":-0.2698,"nsteps":825},{"x":424.4826,"y":345.6456,"step0":7170,"agentStep":1,"dx":-0.4698,"dy":0.2179,"nsteps":90},{"x":719.5471,"y":168.7189,"step0":7178,"agentStep":1,"dx":0.6184,"dy":-0.6488,"nsteps":135},{"x":233.8224,"y":152.7173,"step0":7317,"agentStep":1,"dx":0.6873,"dy":-0.5571,"nsteps":135},{"x":294.0559,"y":375.3306,"step0":7402,"agentStep":1,"dx":0.2634,"dy":-0.0954,"nsteps":480},{"x":459.1473,"y":296.5136,"step0":7525,"agentStep":1,"dx":-1.7572,"dy":-0.0398,"nsteps":75},{"x":741.4963,"y":268.3061,"step0":7629,"agentStep":1,"dx":-0.7866,"dy":0.3109,"nsteps":90},{"x":672.769,"y":238.6185,"step0":7767,"agentStep":1,"dx":-0.023,"dy":0.6407,"nsteps":90},{"x":319.1019,"y":243.1469,"step0":7855,"agentStep":1,"dx":0.5859,"dy":-0.5893,"nsteps":285},{"x":586.745,"y":320.0694,"step0":7869,"agentStep":1,"dx":-0.5278,"dy":0.03,"nsteps":315},{"x":427.0313,"y":379.1866,"step0":7946,"agentStep":1,"dx":-0.407,"dy":0.376,"nsteps":210},{"x":260.0311,"y":183.7653,"step0":7960,"agentStep":1,"dx":1.8047,"dy":0.1167,"nsteps":285},{"x":670.6995,"y":296.284,"step0":8139,"agentStep":1,"dx":-0.9326,"dy":0.4022,"nsteps":120},{"x":447.8989,"y":317.0255,"step0":8532,"agentStep":1,"dx":0.7026,"dy":-0.1262,"nsteps":360},{"x":905.7766,"y":204.9873,"step0":9095,"agentStep":1,"dx":-0.3886,"dy":0.0076,"nsteps":75},{"x":383.7665,"y":52.8808,"step0":9132,"agentStep":1,"dx":0.3487,"dy":0.461,"nsteps":315},{"x":201.2952,"y":280.8658,"step0":9181,"agentStep":1,"dx":0.2748,"dy":0.2982,"nsteps":210},{"x":697.0728,"y":262.4157,"step0":9219,"agentStep":1,"dx":0.1859,"dy":-0.318,"nsteps":570},{"x":885.8562,"y":249.5551,"step0":9319,"agentStep":1,"dx":-1.3433,"dy":0.0711,"nsteps":180},{"x":728.2477,"y":280.0114,"step0":9370,"agentStep":1,"dx":0.021,"dy":-0.0186,"nsteps":630},{"x":728.2477,"y":280.0114,"step0":9396,"agentStep":1,"dx":0.021,"dy":-0.0186,"nsteps":630},{"x":697.0728,"y":262.4157,"step0":9459,"agentStep":1,"dx":0.1237,"dy":-0.8485,"nsteps":120},{"x":346.6363,"y":268.5276,"step0":9815,"agentStep":1,"dx":-0.0359,"dy":-0.5507,"nsteps":210},{"x":201.2952,"y":280.8658,"step0":9901,"agentStep":1,"dx":0.6299,"dy":0.2521,"nsteps":420},{"x":382.7532,"y":135.7053,"step0":9995,"agentStep":1,"dx":-0.4071,"dy":-0.0316,"nsteps":210},{"x":294.0559,"y":375.3306,"step0":10109,"agentStep":1,"dx":0.0093,"dy":-0.1787,"nsteps":135},{"x":420.5025,"y":329.5348,"step0":10281,"agentStep":1,"dx":-0.6082,"dy":0.0497,"nsteps":675},{"x":383.922,"y":251.7313,"step0":10285,"agentStep":1,"dx":0.3863,"dy":0.8944,"nsteps":105},{"x":326.6126,"y":77.5022,"step0":10542,"agentStep":1,"dx":-0.619,"dy":1.8832,"nsteps":120},{"x":326.6126,"y":77.5022,"step0":10546,"agentStep":1,"dx":-0.7075,"dy":2.1522,"nsteps":105},{"x":259.0118,"y":343.4967,"step0":10698,"agentStep":1,"dx":0.9723,"dy":0.0642,"nsteps":240},{"x":297.2721,"y":129.0681,"step0":10760,"agentStep":1,"dx":-0.2488,"dy":0.0927,"nsteps":255},{"x":714.7051,"y":243.8767,"step0":10781,"agentStep":1,"dx":-0.233,"dy":-0.0292,"nsteps":180},{"x":341.5712,"y":458.142,"step0":11070,"agentStep":1,"dx":-0.389,"dy":-0.3153,"nsteps":555},{"x":808.2642,"y":271.2609,"step0":11240,"agentStep":1,"dx":-0.4576,"dy":0.286,"nsteps":300},{"x":711.9176,"y":160.5935,"step0":11334,"agentStep":1,"dx":-0.7725,"dy":0.0396,"nsteps":585},{"x":711.9176,"y":160.5935,"step0":11364,"agentStep":1,"dx":-0.7928,"dy":0.0407,"nsteps":570},{"x":386.2325,"y":204.5444,"step0":11475,"agentStep":1,"dx":1.172,"dy":-0.0677,"nsteps":390},{"x":884.9919,"y":164.0992,"step0":11546,"agentStep":1,"dx":-0.6151,"dy":0.216,"nsteps":345},{"x":465.8734,"y":386.767,"step0":11558,"agentStep":1,"dx":-0.4211,"dy":-0.0878,"nsteps":405},{"x":539.853,"y":365.8956,"step0":11575,"agentStep":1,"dx":-0.2041,"dy":-0.1272,"nsteps":750},{"x":130.2484,"y":353.3052,"step0":11640,"agentStep":1,"dx":0.2044,"dy":-0.0156,"nsteps":630},{"x":383.922,"y":251.7313,"step0":11668,"agentStep":1,"dx":1.0933,"dy":0.2366,"nsteps":150},{"x":774.3786,"y":217.0344,"step0":11742,"agentStep":1,"dx":1.4864,"dy":0.4336,"nsteps":75},{"x":339.0909,"y":152.886,"step0":11976,"agentStep":1,"dx":0.6684,"dy":-0.1472,"nsteps":855},{"x":478.7574,"y":270.3406,"step0":12370,"agentStep":1,"dx":0.1446,"dy":-0.5024,"nsteps":195},{"x":876.6335,"y":205.5558,"step0":12453,"agentStep":1,"dx":-2.0133,"dy":0.2557,"nsteps":225},{"x":558.7872,"y":344.5434,"step0":12471,"agentStep":1,"dx":-0.7182,"dy":-0.6101,"nsteps":405},{"x":829.5524,"y":208.6752,"step0":12670,"agentStep":1,"dx":-0.3333,"dy":-0.1211,"nsteps":330},{"x":198.6434,"y":424.0676,"step0":12906,"agentStep":1,"dx":0.8105,"dy":-0.317,"nsteps":585},{"x":885.8562,"y":249.5551,"step0":13136,"agentStep":1,"dx":-1.6791,"dy":0.2306,"nsteps":450},{"x":297.2721,"y":129.0681,"step0":13275,"agentStep":1,"dx":3.1648,"dy":1.1502,"nsteps":90},{"x":775.9459,"y":192.9799,"step0":13530,"agentStep":1,"dx":0.0031,"dy":-0.0359,"nsteps":495},{"x":719.5471,"y":168.7189,"step0":13975,"agentStep":1,"dx":0.5565,"dy":-0.5839,"nsteps":150},{"x":264.9161,"y":276.6056,"step0":14132,"agentStep":1,"dx":-0.7767,"dy":0.3286,"nsteps":90},{"x":418.685,"y":280.4735,"step0":14398,"agentStep":1,"dx":0.2997,"dy":0.1188,"nsteps":135},{"x":509.1255,"y":333.3953,"step0":14483,"agentStep":1,"dx":0.6371,"dy":-0.2037,"nsteps":165},{"x":894.5736,"y":81.9153,"step0":14696,"agentStep":1,"dx":-0.372,"dy":0.0799,"nsteps":195},{"x":334.086,"y":411.4482,"step0":15325,"agentStep":1,"dx":0.2308,"dy":-0.1702,"nsteps":885},{"x":719.5471,"y":168.7189,"step0":15424,"agentStep":1,"dx":-1.3422,"dy":0.6821,"nsteps":135},{"x":719.5471,"y":168.7189,"step0":15452,"agentStep":1,"dx":-0.158,"dy":0.0734,"nsteps":870},{"x":616.4377,"y":82.0059,"step0":15476,"agentStep":1,"dx":-0.9383,"dy":-0.2307,"nsteps":165},{"x":843.3266,"y":178.1473,"step0":15908,"agentStep":1,"dx":-0.8252,"dy":-0.0629,"nsteps":150},{"x":547.9122,"y":287.2187,"step0":15996,"agentStep":1,"dx":0.7179,"dy":-0.4732,"nsteps":315},{"x":517.4786,"y":142.7623,"step0":16254,"agentStep":1,"dx":0.9427,"dy":0.4073,"nsteps":210},{"x":517.4786,"y":142.7623,"step0":16271,"agentStep":1,"dx":-0.8055,"dy":-0.577,"nsteps":135},{"x":500.2324,"y":429.1269,"step0":16730,"agentStep":1,"dx":-0.0491,"dy":-0.0955,"nsteps":345},{"x":173.8792,"y":409.2186,"step0":16755,"agentStep":1,"dx":0.3478,"dy":0.0555,"nsteps":315},{"x":777.503,"y":175.2011,"step0":16890,"agentStep":1,"dx":-0.8088,"dy":0.0268,"nsteps":180},{"x":714.7051,"y":243.8767,"step0":16976,"agentStep":1,"dx":-0.2796,"dy":-0.0351,"nsteps":150},{"x":616.4377,"y":82.0059,"step0":16984,"agentStep":1,"dx":0.3241,"dy":0.5739,"nsteps":345},{"x":259.0118,"y":343.4967,"step0":17046,"agentStep":1,"dx":0.8549,"dy":-0.0142,"nsteps":255},{"x":259.0118,"y":343.4967,"step0":17247,"agentStep":1,"dx":-0.2698,"dy":0.1199,"nsteps":300},{"x":259.0118,"y":343.4967,"step0":17289,"agentStep":1,"dx":-0.2249,"dy":0.0999,"nsteps":360},{"x":295.3139,"y":351.2065,"step0":17663,"agentStep":1,"dx":-1.5146,"dy":0.5794,"nsteps":105},{"x":470.8954,"y":220.9697,"step0":17846,"agentStep":1,"dx":-1.1715,"dy":-0.2067,"nsteps":180},{"x":493.6023,"y":198.0847,"step0":17871,"agentStep":1,"dx":-0.2315,"dy":0.0703,"nsteps":600},{"x":672.769,"y":238.6185,"step0":18017,"agentStep":1,"dx":-0.2358,"dy":0.1572,"nsteps":765},{"x":386.2325,"y":204.5444,"step0":18091,"agentStep":1,"dx":0.5311,"dy":-0.0293,"nsteps":150},{"x":810.8967,"y":178.6621,"step0":18131,"agentStep":1,"dx":-0.7612,"dy":-0.0829,"nsteps":120},{"x":583.6073,"y":147.6809,"step0":18135,"agentStep":1,"dx":-1.0962,"dy":-0.2231,"nsteps":240},{"x":341.5712,"y":458.142,"step0":18415,"agentStep":1,"dx":1.3725,"dy":-0.4212,"nsteps":240},{"x":509.1255,"y":333.3953,"step0":18465,"agentStep":1,"dx":0.654,"dy":0.1426,"nsteps":135},{"x":719.5471,"y":168.7189,"step0":18489,"agentStep":1,"dx":-0.015,"dy":-0.0159,"nsteps":510},{"x":386.7695,"y":270.4652,"step0":18656,"agentStep":1,"dx":0.386,"dy":-0.0672,"nsteps":855},{"x":283.4462,"y":426.6969,"step0":18658,"agentStep":1,"dx":0.9178,"dy":-0.2738,"nsteps":300},{"x":459.7572,"y":137.2987,"step0":18766,"agentStep":1,"dx":0.0264,"dy":0.1848,"nsteps":720},{"x":267.9168,"y":97.4491,"step0":18772,"agentStep":1,"dx":0.9467,"dy":0.3386,"nsteps":555},{"x":719.5471,"y":168.7189,"step0":18942,"agentStep":1,"dx":-1.2652,"dy":-0.1487,"nsteps":240},{"x":728.2477,"y":280.0114,"step0":19391,"agentStep":1,"dx":0.6794,"dy":0.7342,"nsteps":75},{"x":614.2482,"y":299.7858,"step0":19680,"agentStep":1,"dx":-1.5248,"dy":0.4454,"nsteps":90},{"x":252.3286,"y":303.4857,"step0":19692,"agentStep":1,"dx":0.4723,"dy":-0.4612,"nsteps":495},{"x":486.095,"y":75.1906,"step0":19857,"agentStep":1,"dx":-0.6185,"dy":0.6221,"nsteps":270},{"x":461.6178,"y":43.9436,"step0":19901,"agentStep":1,"dx":-0.1594,"dy":0.0567,"nsteps":885},{"x":130.2484,"y":353.3052,"step0":19932,"agentStep":1,"dx":0.2765,"dy":-0.4685,"nsteps":270},{"x":876.6335,"y":205.5558,"step0":19938,"agentStep":1,"dx":-0.1663,"dy":0.0187,"nsteps":615},{"x":728.2477,"y":280.0114,"step0":19993,"agentStep":1,"dx":-0.5956,"dy":0.0287,"nsteps":165},{"x":459.1473,"y":296.5136,"step0":20167,"agentStep":1,"dx":0.0997,"dy":-0.0713,"nsteps":180},{"x":905.7766,"y":204.9873,"step0":20316,"agentStep":1,"dx":-0.4498,"dy":0.0845,"nsteps":210},{"x":905.7766,"y":204.9873,"step0":20331,"agentStep":1,"dx":-0.2576,"dy":0.0236,"nsteps":510},{"x":178.0631,"y":379.4561,"step0":20402,"agentStep":1,"dx":-0.1164,"dy":-0.214,"nsteps":450},{"x":427.0313,"y":379.1866,"step0":20718,"agentStep":1,"dx":0.0947,"dy":-0.0294,"nsteps":690},{"x":178.0631,"y":379.4561,"step0":20725,"agentStep":1,"dx":-0.1455,"dy":-0.2675,"nsteps":360},{"x":383.922,"y":251.7313,"step0":21003,"agentStep":1,"dx":-0.0453,"dy":-0.0178,"nsteps":645},{"x":470.9279,"y":21.0701,"step0":21075,"agentStep":1,"dx":0.9825,"dy":0.2724,"nsteps":345},{"x":415.8929,"y":133.0249,"step0":21145,"agentStep":1,"dx":-0.4887,"dy":0.3722,"nsteps":270},{"x":130.2484,"y":353.3052,"step0":21351,"agentStep":1,"dx":0.7869,"dy":-0.459,"nsteps":240},{"x":582.1059,"y":232.5884,"step0":21776,"agentStep":1,"dx":0.0973,"dy":-0.0277,"nsteps":555},{"x":327.3544,"y":293.5249,"step0":21854,"agentStep":1,"dx":0.0818,"dy":-0.1236,"nsteps":720},{"x":670.6995,"y":296.284,"step0":21889,"agentStep":1,"dx":-0.9507,"dy":-0.3669,"nsteps":210},{"x":252.3286,"y":303.4857,"step0":21924,"agentStep":1,"dx":-1.0097,"dy":0.2483,"nsteps":240},{"x":631.9139,"y":180.0292,"step0":21938,"agentStep":1,"dx":-1.5698,"dy":0.2671,"nsteps":270},{"x":267.9168,"y":97.4491,"step0":22004,"agentStep":1,"dx":1.2707,"dy":0.3561,"nsteps":240},{"x":339.0909,"y":152.886,"step0":22134,"agentStep":1,"dx":1.2103,"dy":0.291,"nsteps":405},{"x":810.8967,"y":178.6621,"step0":22595,"agentStep":1,"dx":-0.954,"dy":-0.3938,"nsteps":300},{"x":650.2301,"y":54.1781,"step0":22775,"agentStep":1,"dx":-0.6321,"dy":0.4218,"nsteps":210},{"x":341.5712,"y":458.142,"step0":22877,"agentStep":1,"dx":-1.0159,"dy":-0.1075,"nsteps":135},{"x":644.0612,"y":262.3592,"step0":22996,"agentStep":1,"dx":0.2059,"dy":0.2149,"nsteps":270},{"x":283.9526,"y":233.5212,"step0":23293,"agentStep":1,"dx":0.1241,"dy":0.0118,"nsteps":570},{"x":408.736,"y":64.8658,"step0":23677,"agentStep":1,"dx":0.0795,"dy":0.7573,"nsteps":90},{"x":201.2952,"y":280.8658,"step0":24010,"agentStep":1,"dx":1.0112,"dy":0.0614,"nsteps":255},{"x":811.319,"y":222.7256,"step0":24023,"agentStep":1,"dx":-1.2747,"dy":0.4057,"nsteps":120},{"x":950,"y":94.3759,"step0":24256,"agentStep":1,"dx":-0.8922,"dy":0.8467,"nsteps":135},{"x":905.5164,"y":59.8926,"step0":24337,"agentStep":1,"dx":0.0484,"dy":-0.3129,"nsteps":105},{"x":295.3139,"y":351.2065,"step0":24396,"agentStep":1,"dx":0.7902,"dy":-0.2538,"nsteps":135},{"x":383.922,"y":251.7313,"step0":24453,"agentStep":1,"dx":0.5748,"dy":0.1128,"nsteps":165},{"x":478.7574,"y":270.3406,"step0":24487,"agentStep":1,"dx":-0.3285,"dy":0.672,"nsteps":255},{"x":779.204,"y":335.075,"step0":24640,"agentStep":1,"dx":0.3248,"dy":-0.4317,"nsteps":300},{"x":808.2642,"y":271.2609,"step0":24660,"agentStep":1,"dx":-0.7298,"dy":-0.0396,"nsteps":225},{"x":382.2002,"y":365.2534,"step0":24730,"agentStep":1,"dx":-0.624,"dy":-0.1969,"nsteps":300},{"x":260.0311,"y":183.7653,"step0":24800,"agentStep":1,"dx":0.1707,"dy":-0.2725,"nsteps":390},{"x":125.6955,"y":283.1604,"step0":24959,"agentStep":1,"dx":1.055,"dy":-0.3309,"nsteps":150},{"x":558.7872,"y":344.5434,"step0":25278,"agentStep":1,"dx":0.3427,"dy":-0.4489,"nsteps":270},{"x":905.7766,"y":204.9873,"step0":25510,"agentStep":1,"dx":-0.3862,"dy":-0.874,"nsteps":210},{"x":676.3458,"y":273.3834,"step0":25631,"agentStep":1,"dx":-0.6843,"dy":-0.1805,"nsteps":300},{"x":334.086,"y":411.4482,"step0":25751,"agentStep":1,"dx":0.6041,"dy":-0.1832,"nsteps":600},{"x":803.0275,"y":81.1371,"step0":25752,"agentStep":1,"dx":1.2206,"dy":0.0104,"nsteps":75},{"x":583.6073,"y":147.6809,"step0":25790,"agentStep":1,"dx":-0.8817,"dy":-0.0656,"nsteps":75},{"x":415.8929,"y":133.0249,"step0":25852,"agentStep":1,"dx":-0.0502,"dy":0.0041,"nsteps":660},{"x":728.2477,"y":280.0114,"step0":26050,"agentStep":1,"dx":-0.6612,"dy":0.3436,"nsteps":135},{"x":779.7058,"y":284.6798,"step0":26090,"agentStep":1,"dx":-0.7113,"dy":0.2714,"nsteps":75},{"x":465.8938,"y":200.1428,"step0":26090,"agentStep":1,"dx":1.0798,"dy":0.3771,"nsteps":165},{"x":420.5025,"y":329.5348,"step0":26259,"agentStep":1,"dx":-1.1146,"dy":0.3236,"nsteps":255},{"x":206.7405,"y":405.501,"step0":26287,"agentStep":1,"dx":0.1724,"dy":-0.5265,"nsteps":525},{"x":774.3786,"y":217.0344,"step0":26501,"agentStep":1,"dx":-0.2603,"dy":-0.6926,"nsteps":165},{"x":320.5255,"y":94.1375,"step0":26504,"agentStep":1,"dx":0.4201,"dy":0.6133,"nsteps":330},{"x":670.6995,"y":296.284,"step0":26630,"agentStep":1,"dx":0.229,"dy":-0.7538,"nsteps":180},{"x":905.7766,"y":204.9873,"step0":26867,"agentStep":1,"dx":-1.2075,"dy":0.0396,"nsteps":360},{"x":478.7574,"y":270.3406,"step0":26888,"agentStep":1,"dx":-0.2683,"dy":-1.0848,"nsteps":240},{"x":319.1019,"y":243.1469,"step0":27113,"agentStep":1,"dx":0.2579,"dy":0.4462,"nsteps":240},{"x":208.0697,"y":252.1449,"step0":27266,"agentStep":1,"dx":0.6796,"dy":0.2388,"nsteps":585},{"x":394.9943,"y":441.7,"step0":27519,"agentStep":1,"dx":1.1499,"dy":-0.3527,"nsteps":240},{"x":136.282,"y":412.0427,"step0":27577,"agentStep":1,"dx":0.5519,"dy":-0.1975,"nsteps":585},{"x":459.1473,"y":296.5136,"step0":27902,"agentStep":1,"dx":1.0863,"dy":0.3104,"nsteps":195},{"x":471.0621,"y":219.2328,"step0":28116,"agentStep":1,"dx":0.9334,"dy":-0.0875,"nsteps":165},{"x":672.769,"y":238.6185,"step0":28217,"agentStep":1,"dx":-0.227,"dy":-0.3255,"nsteps":180},{"x":636.0871,"y":217.2226,"step0":28427,"agentStep":1,"dx":0.3178,"dy":-0.3815,"nsteps":300},{"x":382.7532,"y":135.7053,"step0":28492,"agentStep":1,"dx":-0.4678,"dy":-0.485,"nsteps":120},{"x":658.3549,"y":271.4074,"step0":28533,"agentStep":1,"dx":1.2747,"dy":-0.4057,"nsteps":120},{"x":136.282,"y":412.0427,"step0":28602,"agentStep":1,"dx":0.9687,"dy":-0.1978,"nsteps":465},{"x":779.204,"y":335.075,"step0":28984,"agentStep":1,"dx":0.1603,"dy":-0.2591,"nsteps":660},{"x":327.3544,"y":293.5249,"step0":28994,"agentStep":1,"dx":-0.1666,"dy":-0.0908,"nsteps":735},{"x":386.2325,"y":204.5444,"step0":29042,"agentStep":1,"dx":0.1407,"dy":0.2777,"nsteps":690},{"x":583.6073,"y":147.6809,"step0":29255,"agentStep":1,"dx":0.591,"dy":0.0322,"nsteps":510},{"x":583.6073,"y":147.6809,"step0":29284,"agentStep":1,"dx":0.6089,"dy":0.0332,"nsteps":495},{"x":699.6653,"y":320.3901,"step0":29334,"agentStep":1,"dx":-0.7125,"dy":-0.5321,"nsteps":165},{"x":283.9526,"y":233.5212,"step0":29362,"agentStep":1,"dx":1.0274,"dy":-0.1187,"nsteps":585},{"x":876.6335,"y":205.5558,"step0":29456,"agentStep":1,"dx":0.0589,"dy":-0.0011,"nsteps":495},{"x":459.7572,"y":137.2987,"step0":29588,"agentStep":1,"dx":0.8422,"dy":0.1379,"nsteps":495},{"x":597.4216,"y":352.6496,"step0":29683,"agentStep":1,"dx":0.1122,"dy":-0.3524,"nsteps":150},{"x":381.0078,"y":350.2319,"step0":29798,"agentStep":1,"dx":0.4949,"dy":0.0385,"nsteps":225},{"x":544.2661,"y":202.9301,"step0":29963,"agentStep":1,"dx":0.2725,"dy":-0.1907,"nsteps":105},{"x":334.086,"y":411.4482,"step0":29984,"agentStep":1,"dx":0.9666,"dy":-0.2931,"nsteps":375},{"x":506.9536,"y":172.3721,"step0":30157,"agentStep":1,"dx":0.9773,"dy":0.3997,"nsteps":240},{"x":793.3463,"y":285.3978,"step0":30376,"agentStep":1,"dx":-0.7349,"dy":-0.3416,"nsteps":300},{"x":614.2482,"y":299.7858,"step0":30569,"agentStep":1,"dx":-1.0036,"dy":-0.2181,"nsteps":135},{"x":517.4786,"y":142.7623,"step0":30928,"agentStep":1,"dx":1.3302,"dy":0.2326,"nsteps":270},{"x":204.421,"y":443.6268,"step0":30963,"agentStep":1,"dx":0.1145,"dy":-0.0245,"nsteps":690},{"x":583.023,"y":208.4908,"step0":31032,"agentStep":1,"dx":0.9817,"dy":0.5259,"nsteps":120},{"x":478.7574,"y":270.3406,"step0":31173,"agentStep":1,"dx":0.6621,"dy":-0.106,"nsteps":90},{"x":394.9943,"y":441.7,"step0":31199,"agentStep":1,"dx":-0.1582,"dy":-0.0213,"nsteps":705},{"x":195.0103,"y":306.1785,"step0":31341,"agentStep":1,"dx":0.4864,"dy":0.2482,"nsteps":285},{"x":381.0078,"y":350.2319,"step0":31715,"agentStep":1,"dx":0.063,"dy":-0.0066,"nsteps":690},{"x":777.503,"y":175.2011,"step0":31746,"agentStep":1,"dx":-0.7493,"dy":0.7273,"nsteps":135},{"x":696.5741,"y":301.5538,"step0":31803,"agentStep":1,"dx":0.6611,"dy":-0.4823,"nsteps":285},{"x":558.7872,"y":344.5434,"step0":31834,"agentStep":1,"dx":0.6287,"dy":-0.1388,"nsteps":420},{"x":506.9536,"y":172.3721,"step0":31915,"agentStep":1,"dx":-1.1191,"dy":-0.1299,"nsteps":150},{"x":538.347,"y":260.8048,"step0":31985,"agentStep":1,"dx":-0.3066,"dy":0.6539,"nsteps":150},{"x":732.636,"y":103.0133,"step0":32055,"agentStep":1,"dx":-0.0948,"dy":0.4251,"nsteps":375},{"x":711.9176,"y":160.5935,"step0":32192,"agentStep":1,"dx":0.2991,"dy":0.7755,"nsteps":225},{"x":876.6335,"y":205.5558,"step0":32269,"agentStep":1,"dx":0.036,"dy":-0.0007,"nsteps":810},{"x":711.9176,"y":160.5935,"step0":32334,"agentStep":1,"dx":0.9941,"dy":0.2277,"nsteps":195},{"x":644.0612,"y":262.3592,"step0":32343,"agentStep":1,"dx":-0.4273,"dy":0.1105,"nsteps":225},{"x":582.1059,"y":232.5884,"step0":32677,"agentStep":1,"dx":-1.3618,"dy":0.399,"nsteps":120},{"x":884.9919,"y":164.0992,"step0":33047,"agentStep":1,"dx":-9.068,"dy":0.8362,"nsteps":75},{"x":779.204,"y":335.075,"step0":33341,"agentStep":1,"dx":0.2251,"dy":-0.5425,"nsteps":315},{"x":884.9919,"y":164.0992,"step0":33494,"agentStep":1,"dx":-1.114,"dy":0.4863,"nsteps":540},{"x":459.7572,"y":137.2987,"step0":33906,"agentStep":1,"dx":-0.2542,"dy":0.69,"nsteps":465},{"x":125.6955,"y":283.1604,"step0":33943,"agentStep":1,"dx":0.6412,"dy":0.3775,"nsteps":420},{"x":125.6955,"y":283.1604,"step0":33962,"agentStep":1,"dx":0.6412,"dy":0.3775,"nsteps":420},{"x":333.6378,"y":376.9287,"step0":34063,"agentStep":1,"dx":-0.5577,"dy":0.553,"nsteps":90},{"x":478.7574,"y":270.3406,"step0":34079,"agentStep":1,"dx":0.497,"dy":-0.6266,"nsteps":345},{"x":811.319,"y":222.7256,"step0":34275,"agentStep":1,"dx":0.3696,"dy":-0.5574,"nsteps":105},{"x":876.6335,"y":205.5558,"step0":34300,"agentStep":1,"dx":0.01,"dy":-0.0494,"nsteps":840},{"x":777.503,"y":175.2011,"step0":34303,"agentStep":1,"dx":-0.9147,"dy":0.1087,"nsteps":255},{"x":478.7574,"y":270.3406,"step0":34496,"agentStep":1,"dx":0.1819,"dy":0.5142,"nsteps":75},{"x":670.6995,"y":296.284,"step0":34649,"agentStep":1,"dx":0.0616,"dy":0.0125,"nsteps":420},{"x":517.4786,"y":142.7623,"step0":34788,"agentStep":1,"dx":0.1357,"dy":-0.1461,"nsteps":405},{"x":156.0638,"y":261.33,"step0":34805,"agentStep":1,"dx":0.0942,"dy":0.0407,"nsteps":480},{"x":884.9919,"y":164.0992,"step0":34823,"agentStep":1,"dx":-0.0496,"dy":0.0167,"nsteps":840},{"x":283.4462,"y":426.6969,"step0":35168,"agentStep":1,"dx":0.0993,"dy":-0.0299,"nsteps":510},{"x":779.1281,"y":151.988,"step0":35183,"agentStep":1,"dx":0.1283,"dy":0.0147,"nsteps":825},{"x":829.5524,"y":208.6752,"step0":35686,"agentStep":1,"dx":-0.6111,"dy":-0.222,"nsteps":180},{"x":829.5524,"y":208.6752,"step0":35709,"agentStep":1,"dx":-0.6111,"dy":-0.222,"nsteps":180},{"x":459.1473,"y":296.5136,"step0":36050,"agentStep":1,"dx":0.0594,"dy":-0.0793,"nsteps":330},{"x":283.4462,"y":426.6969,"step0":36050,"agentStep":1,"dx":-0.9115,"dy":-0.212,"nsteps":300},{"x":700.8231,"y":271.602,"step0":36098,"agentStep":1,"dx":-0.1269,"dy":0.1603,"nsteps":750},{"x":651.3122,"y":223.3411,"step0":36282,"agentStep":1,"dx":-1.3541,"dy":0.5834,"nsteps":285},{"x":779.1281,"y":151.988,"step0":36435,"agentStep":1,"dx":0.1764,"dy":0.0202,"nsteps":600},{"x":644.0612,"y":262.3592,"step0":36454,"agentStep":1,"dx":-0.0795,"dy":0.0998,"nsteps":375},{"x":459.1473,"y":296.5136,"step0":36628,"agentStep":1,"dx":0.0498,"dy":0.6685,"nsteps":135},{"x":544.2661,"y":202.9301,"step0":36692,"agentStep":1,"dx":-0.7611,"dy":0.47,"nsteps":165},{"x":492.3557,"y":358.8947,"step0":36780,"agentStep":1,"dx":-1.0808,"dy":0.1462,"nsteps":210},{"x":719.5471,"y":168.7189,"step0":36839,"agentStep":1,"dx":0.0527,"dy":0.6745,"nsteps":165},{"x":418.1729,"y":490,"step0":36857,"agentStep":1,"dx":-0.1335,"dy":-0.1247,"nsteps":630},{"x":418.1729,"y":490,"step0":36895,"agentStep":1,"dx":-0.1335,"dy":-0.1247,"nsteps":630},{"x":423.6304,"y":263.0975,"step0":36956,"agentStep":1,"dx":-0.0802,"dy":-0.023,"nsteps":495},{"x":506.9536,"y":172.3721,"step0":37049,"agentStep":1,"dx":-0.7588,"dy":-0.3279,"nsteps":120},{"x":283.4462,"y":426.6969,"step0":37062,"agentStep":1,"dx":-0.4444,"dy":-0.1847,"nsteps":495},{"x":586.745,"y":320.0694,"step0":37121,"agentStep":1,"dx":-1.5554,"dy":0.5468,"nsteps":195},{"x":631.9139,"y":180.0292,"step0":37228,"agentStep":1,"dx":-0.9219,"dy":0.7361,"nsteps":225},{"x":326.6126,"y":77.5022,"step0":37285,"agentStep":1,"dx":0.754,"dy":0.7031,"nsteps":345},{"x":741.4963,"y":268.3061,"step0":37405,"agentStep":1,"dx":0.8902,"dy":0.0394,"nsteps":75},{"x":884.9919,"y":164.0992,"step0":37436,"agentStep":1,"dx":-0.0061,"dy":0.14,"nsteps":795},{"x":418.685,"y":280.4735,"step0":37439,"agentStep":1,"dx":1.1956,"dy":-0.0451,"nsteps":270},{"x":297.2721,"y":129.0681,"step0":37477,"agentStep":1,"dx":-0.244,"dy":0.1398,"nsteps":270},{"x":459.1473,"y":296.5136,"step0":37523,"agentStep":1,"dx":-0.015,"dy":0.0273,"nsteps":750},{"x":420.5025,"y":329.5348,"step0":37582,"agentStep":1,"dx":-0.0774,"dy":0.0406,"nsteps":510},{"x":829.2428,"y":270.7227,"step0":37622,"agentStep":1,"dx":-0.3927,"dy":0.1505,"nsteps":330},{"x":470.8954,"y":220.9697,"step0":37641,"agentStep":1,"dx":-0.3745,"dy":0.5386,"nsteps":240},{"x":829.2428,"y":270.7227,"step0":37761,"agentStep":1,"dx":-0.3927,"dy":0.1505,"nsteps":330},{"x":696.5741,"y":301.5538,"step0":37790,"agentStep":1,"dx":1.0752,"dy":-0.1795,"nsteps":90},{"x":418.1729,"y":490,"step0":37794,"agentStep":1,"dx":-0.5825,"dy":-0.5082,"nsteps":450},{"x":905.7766,"y":204.9873,"step0":37848,"agentStep":1,"dx":-0.6837,"dy":-0.4009,"nsteps":255}] ;




/* Helper functions */ 
/* ================ */ 

function circle(ctx, x, y, r, color) {

	ctx.beginPath();
	ctx.fillStyle = color;
	ctx.arc(x, y, r, 0, 2 * Math.PI);
	ctx.fill();

} // circle() 
 

/* Drawing the background */
/* ====================== */

function drawStations() {
	context.save();
	d3.range(stations.length).forEach(function(el) {
			//circle(context, stations[el][0], stations[el][1], 10, 'blue');
			context.fillStyle = 'royalblue';
			context.fillRect(stations[el][0]-2, stations[el][1]-2, 4, 4);
		});
}

function drawBikes() {
	d3.range(visibleagents.agents.length).forEach(function(el) {
			circle(context, visibleagents.agents[el].x, visibleagents.agents[el].y, 6, 'red');
		});
}


/* Letting it rain */
/* =============== */

var step = {
	length : 4,
	currentStep : 0,
	nextstep : function() {
		return step.currentStep + step.length;
	}
}

var visibleagents = {
	agents : [{}],
	initialized : 0,
	init : function () {
		var result =[{}];
		result = trips.filter(function (el) {
				return step.currentStep >= el.step0 & 
					   step.currentStep <= el.step0 + el.nsteps;});
		return result ;
	},
	newAgents : function() {
		var newag =[{}];
		newag = trips.filter(function (el) {
				return step.currentStep >= el.step0 & 
					   step.currentStep <= el.step0 + step.length;});
					   
		var result = visibleagents.agents.concat(newag);
		return result;
	},
	dropOldAgents : function() {
		var result =[{}];
		result = visibleagents.agents.filter(function (el) {
				return el.agentStep <= el.nsteps;});
		return result ;
	},
	nextStep : function() {
		for (var i = 0; i < visibleagents.agents.length; i++) {
			visibleagents.agents[i].agentStep = visibleagents.agents[i].agentStep + 1;
			visibleagents.agents[i].x = 
				visibleagents.agents[i].x + visibleagents.agents[i].dx;
			visibleagents.agents[i].y = 
				visibleagents.agents[i].y + visibleagents.agents[i].dy;
			console.log(visibleagents.agents[i].agentStep);
		}
		return visibleagents.agents;
	}
}

function update() {
	if (visibleagents.initialized == 0){
		visibleagents.agents = visibleagents.init();
		console.log(visibleagents.agents);
		visibleagents.initialized = 1;
	}
	step.currentStep = step.nextstep();
	visibleagents.agents = visibleagents.nextStep();
	visibleagents.agents = visibleagents.dropOldAgents();
	visibleagents.agents = visibleagents.newAgents();
} // animate()



d3.interval(function() {
	update();
	context.clearRect(0, 0, canvas.width, canvas.height);
	drawStations();
	drawBikes();
}, 1000/fps); // making it rain




/* Interact */
/* ======== */
	
d3.select('button#drawScenario').on('mousedown', drawScenario);
d3.select('button#update').on('mousedown', updateRain);
d3.select('button#exit').on('mousedown', exitRain);


function drawScenario() {
	/*for (var i=1; i<50; i++){
		update();
		context.clearRect(0, 0, canvas.width, canvas.height);
		drawStations();
		drawBikes();
		step.currentStep;
	}*/
};


function updateRain() {
	drawScenario();
};

function exitRain() {	
	rainAnimation([]);
};



</script>

</body>
</html>